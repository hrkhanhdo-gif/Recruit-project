<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome (kept for backward compatibility) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Quill.js CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">



    <?!= include('css'); ?>
    <script>
        window.onerror = function (message, source, lineno, colno, error) {
            alert('Global Error: ' + message + ' at line ' + lineno);
        };
        var hasDB = <?!= typeof isDbSetup !== "undefined" ? isDbSetup : "false" ?>;
    </script>
</head>

<body>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-box">
            <div class="mb-4">
                <span class="material-icons-outlined"
                    style="font-size: 64px; color: var(--primary);">account_circle</span>
            </div>
            <h2>Đăng Nhập Hệ Thống</h2>
            <p class="text-muted mb-4" style="font-size: 0.85rem;">HR RECRUIT — Hệ thống quản lý tuyển dụng</p>
            <div class="mb-3 text-start">
                <label class="form-label">Tên đăng nhập</label>
                <input type="text" class="form-control" id="login-username" placeholder="admin">
            </div>
            <div class="mb-4 text-start">
                <label class="form-label">Mật khẩu</label>
                <input type="password" class="form-control" id="login-password" placeholder="******">
            </div>
            <button class="btn btn-tech w-100 py-3" onclick="handleLogin()">ĐĂNG NHẬP</button>
            <p class="mt-3 text-muted" id="login-message"></p>
            <div id="login-loader" class="spinner-border mt-3" role="status" style="display:none;">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <!-- MAIN APP (Hidden by default) -->
    <div id="app-container" style="display:none;">

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="brand">
                <span class="material-icons-outlined">work</span> HR RECRUIT
            </div>
            <nav>
                <a href="#" class="nav-link active" onclick="showSection('dashboard', this); return false;">
                    <span class="material-icons-outlined">dashboard</span> Tổng Quan
                    <span id="nav-eval-badge" class="badge rounded-pill bg-danger ms-1"
                        style="display:none; font-size: 0.65rem;">0</span>
                </a>
                <a href="#" class="nav-link" onclick="showSection('candidates', this); return false;">
                    <span class="material-icons-outlined">people</span> Ứng Viên
                </a>
                <a href="#" class="nav-link" onclick="showSection('kanban', this); return false;">
                    <span class="material-icons-outlined">view_kanban</span> Bảng Kanban
                </a>
                <a href="#" class="nav-link" onclick="showSection('evaluations', this); return false;"
                    id="nav-evaluations">
                    <span class="material-icons-outlined">fact_check</span> Đánh giá PV
                </a>
                <a href="#" class="nav-link" onclick="showSection('jobs', this); return false;" id="nav-jobs">
                    <span class="material-icons-outlined">work_outline</span> Vị trí Tuyển dụng
                </a>
                <a href="#" class="nav-link" onclick="showSection('recruitment-hub', this); return false;"
                    id="nav-recruitment-hub">
                    <span class="material-icons-outlined">hub</span> Quản lý Tuyển dụng
                </a>
                <a href="#" class="nav-link" onclick="showSection('calendar-section', this); return false;"
                    id="nav-calendar">
                    <span class="material-icons-outlined">calendar_month</span> Lịch phỏng vấn
                </a>
                <a href="#" class="nav-link" onclick="showSection('settings', this); return false;" id="nav-settings">
                    <span class="material-icons-outlined">settings</span> Cài Đặt
                </a>
                <a href="#" class="nav-link" onclick="logout(); return false;">
                    <span class="material-icons-outlined">logout</span> Đăng Xuất
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">

            <!-- Top Bar -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 id="page-title" class="fw-bold" style="font-size: 1.5rem; letter-spacing: -0.5px;">Tổng Quan</h3>
                <div class="d-flex align-items-center gap-3">
                    <span class="fw-bold" style="font-size: 0.9rem;"><span class="material-icons-outlined"
                            style="font-size: 18px; vertical-align: middle;">person</span> Xin chào, <span
                            id="current-user-display">Admin</span></span>
                    <div class="dropdown">
                        <button class="btn btn-sm position-relative" id="btn-notifications" data-bs-toggle="dropdown"
                            aria-expanded="false"
                            style="background: var(--primary-light); color: var(--primary); border: none; border-radius: 10px; padding: 6px 12px;">
                            <span class="material-icons-outlined" style="font-size: 20px;">notifications</span>
                            <span
                                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                                id="notification-badge" style="display: none;">
                                0
                                <span class="visually-hidden">unread messages</span>
                            </span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end shadow p-0" aria-labelledby="btn-notifications"
                            style="width: 350px; max-height: 400px; overflow-y: auto;">
                            <li class="p-2 border-bottom d-flex justify-content-between align-items-center bg-light">
                                <span class="fw-bold">Thông báo</span>
                                <small class="text-primary" style="cursor: pointer;"
                                    onclick="markAllNotificationsRead()">Đánh dấu đã đọc</small>
                            </li>
                            <div id="notification-list">
                                <li class="text-center p-3 text-muted">Không có thông báo mới</li>
                            </div>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- SECTIONS -->

            <!-- 1. DASHBOARD -->
            <div id="dashboard" class="section active">
                <!-- Dashboard Filters -->
                <div class="card border-0 shadow-sm p-4 mb-4" style="border-radius: 20px;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-bold mb-0">Bộ lọc Dashboard</h6>
                        <button class="btn btn-sm btn-glass text-primary d-flex align-items-center gap-1"
                            onclick="resetDashboardFilters()">
                            <span class="material-icons-round" style="font-size: 16px;">restart_alt</span>
                            Làm mới
                        </button>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-2">
                            <select id="filter-dash-project" class="form-select form-select-sm"
                                onchange="applyDashboardFilters()">
                                <option value="">Tất cả Dự án</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="filter-dash-ticket" class="form-select form-select-sm"
                                onchange="applyDashboardFilters()">
                                <option value="">Tất cả Ticket</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="filter-dash-dept" class="form-select form-select-sm"
                                onchange="onDashDeptChange()">
                                <option value="">Phòng ban</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="filter-dash-pos" class="form-select form-select-sm"
                                onchange="applyDashboardFilters()">
                                <option value="">Vị trí</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="filter-dash-recruiter" class="form-select form-select-sm"
                                onchange="applyDashboardFilters()">
                                <option value="">Nhân viên</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <div class="input-group input-group-sm">
                                <input type="date" id="filter-dash-start" class="form-control"
                                    onchange="applyDashboardFilters()">
                                <input type="date" id="filter-dash-end" class="form-control"
                                    onchange="applyDashboardFilters()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stat Cards — Glassmorphism -->
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-3 mb-4">
                    <div class="col">
                        <div class="stat-card bg-gradient-blue p-4 h-100">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5>Tổng Ứng Viên</h5>
                                    <h2 class="fw-bold" id="stat-total-candidates">0</h2>
                                </div>
                                <div
                                    style="padding:8px;background:linear-gradient(135deg,#eff6ff,#dbeafe);border-radius:10px;">
                                    <span class="material-icons-outlined"
                                        style="color:#3B82F6;font-size:24px;">groups</span>
                                </div>
                            </div>
                            <small style="color:#10B981;"><span class="material-icons-outlined"
                                    style="font-size:14px;vertical-align:middle;">trending_up</span> Mới trong
                                tuần</small>
                        </div>
                    </div>
                    <div class="col">
                        <div class="stat-card bg-gradient-orange p-4 h-100">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5>Đang Phỏng Vấn</h5>
                                    <h2 class="fw-bold" id="stat-interviewing">0</h2>
                                </div>
                                <div
                                    style="padding:8px;background:linear-gradient(135deg,#fff7ed,#ffedd5);border-radius:10px;">
                                    <span class="material-icons-outlined"
                                        style="color:#F59E0B;font-size:24px;">video_camera_front</span>
                                </div>
                            </div>
                            <small style="color:#F59E0B;">Cần xử lý</small>
                        </div>
                    </div>
                    <div class="col">
                        <div class="stat-card bg-gradient-green p-4 h-100">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5>Đã Tuyển</h5>
                                    <h2 class="fw-bold" id="stat-hired">0</h2>
                                </div>
                                <div
                                    style="padding:8px;background:linear-gradient(135deg,#ecfdf5,#d1fae5);border-radius:10px;">
                                    <span class="material-icons-outlined"
                                        style="color:#10B981;font-size:24px;">how_to_reg</span>
                                </div>
                            </div>
                            <small>Đã nhận việc</small>
                        </div>
                    </div>
                    <div class="col">
                        <div class="stat-card bg-gradient-red p-4 h-100">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5>Đã Từ Chối</h5>
                                    <h2 class="fw-bold" id="stat-rejected">0</h2>
                                </div>
                                <div
                                    style="padding:8px;background:linear-gradient(135deg,#fef2f2,#fee2e2);border-radius:10px;">
                                    <span class="material-icons-outlined"
                                        style="color:#EF4444;font-size:24px;">person_off</span>
                                </div>
                            </div>
                            <small>Không đạt yêu cầu</small>
                        </div>
                    </div>
                    <div class="col">
                        <div class="stat-card bg-gradient-purple p-4 h-100">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5>Tỉ lệ chuyển đổi</h5>
                                    <h2 class="fw-bold" id="stat-conversion-rate-top">0%</h2>
                                </div>
                                <div
                                    style="padding:8px;background:linear-gradient(135deg,#f5f3ff,#ede9fe);border-radius:10px;">
                                    <span class="material-icons-outlined"
                                        style="color:#8B5CF6;font-size:24px;">auto_graph</span>
                                </div>
                            </div>
                            <small>Apply → Hired</small>
                        </div>
                    </div>
                </div>

                <!-- Funnel Chart Area -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="card border-0 shadow-sm p-4 mb-4" style="border-radius: 20px;">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div>
                                    <div class="d-flex align-items-center gap-2 mb-1">
                                        <span class="d-inline-block"
                                            style="height:4px;width:40px;background:linear-gradient(90deg,#10b981,#3b82f6);border-radius:99px;"></span>
                                        <span
                                            style="font-size:0.65rem;font-weight:700;letter-spacing:0.18em;color:#10b981;text-transform:uppercase;font-family:monospace;">Analytics
                                            Engine</span>
                                    </div>
                                    <h5 class="card-title fw-bold mb-0">
                                        Phễu Tuyển Dụng <span
                                            style="background:linear-gradient(90deg,#10b981,#06b6d4,#3b82f6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Pipeline</span>
                                    </h5>
                                </div>
                                <div class="d-flex gap-4 mt-2 flex-wrap" id="funnel-legend">
                                    <!-- Legend rendered by JS -->
                                </div>
                            </div>
                            <!-- Funnel rendered by JS -->
                            <div id="recruitment-funnel-container" style="max-width:750px;margin:0 auto;"></div>
                            <!-- Alert bar -->
                            <div id="funnel-alert-bar"
                                class="mt-4 p-3 d-flex align-items-center justify-content-between gap-3"
                                style="background:#fff5f5;border-radius:14px;border:1px solid #fecaca;display:none!important;">
                                <div class="d-flex align-items-center gap-3">
                                    <div
                                        style="width:38px;height:38px;border-radius:10px;background:rgba(239,68,68,0.1);display:flex;align-items:center;justify-content:center;">
                                        <span class="material-icons-outlined"
                                            style="color:#ef4444;font-size:20px;">emergency_home</span>
                                    </div>
                                    <div>
                                        <div class="fw-bold d-flex align-items-center gap-2" style="font-size:0.85rem;">
                                            Retention Alert
                                            <span
                                                style="padding:1px 6px;border-radius:4px;background:#fee2e2;color:#dc2626;font-size:0.6rem;font-weight:700;text-transform:uppercase;letter-spacing:0.05em;">Critical</span>
                                        </div>
                                        <div id="funnel-alert-msg" class="text-muted"
                                            style="font-size:0.75rem;margin-top:2px;"></div>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-secondary"
                                    style="font-size:0.7rem;font-weight:700;">Review Metrics</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANALYTICS ROW -->
                <div class="row">
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm p-3 mb-4">
                            <h5 class="card-title mb-3">Nguồn ứng viên</h5>
                            <canvas id="sourceChart" height="300"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm p-4 mb-4 bg-primary text-white text-center position-relative overflow-hidden d-flex flex-column justify-content-center"
                            style="min-height: 250px;">
                            <div class="position-absolute" style="top:-10px;right:-10px;opacity:0.15;"><span
                                    class="material-icons-outlined" style="font-size:96px;">timer</span></div>
                            <h5 class="text-uppercase fw-medium mb-2"
                                style="font-size:0.8rem;letter-spacing:1px;opacity:0.9;">Thời Gian Tuyển Dụng TB</h5>
                            <h2 class="fw-bold my-2" id="stat-time-to-hire"
                                style="font-size:3rem;text-shadow:0 2px 4px rgba(0,0,0,0.1);">0</h2>
                            <p class="mb-0"
                                style="font-size:0.75rem;opacity:0.8;background:rgba(255,255,255,0.2);display:inline-block;padding:4px 12px;border-radius:20px;">
                                Trung bình / ứng viên</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm p-3 mb-4">
                            <h5 class="card-title mb-3">Lý do từ chối</h5>
                            <canvas id="rejectionAnalysisChart" height="250"></canvas>
                        </div>
                    </div>
                </div>

                <!-- COSTS & RECRUITER PERFORMANCE -->
                <div class="row">
                    <div class="col-md-7">
                        <div class="card border-0 shadow-sm p-4 mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="card-title fw-bold">
                                    <span class="material-icons-round text-primary me-2">leaderboard</span>
                                    Bảng xếp hạng Recruiter
                                </h5>
                                <span class="badge bg-primary-light text-primary">Hit Rate (%)</span>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle border-0" id="recruiter-leaderboard">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="border-0 text-muted" style="font-size: 0.75rem;">RECRUITER</th>
                                            <th class="border-0 text-muted" style="font-size: 0.75rem;">XỬ LÝ</th>
                                            <th class="border-0 text-muted" style="font-size: 0.75rem;">HIRE</th>
                                            <th class="border-0 text-muted" style="font-size: 0.75rem;">TIME (AVG)</th>
                                            <th class="border-0 text-muted" style="font-size: 0.75rem;">HIT RATE</th>
                                        </tr>
                                    </thead>
                                    <tbody style="font-size: 0.85rem;">
                                        <!-- Dynamic Content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="card border-0 shadow-sm p-4 mb-4">
                            <h5 class="card-title fw-bold mb-4">
                                <span class="material-icons-round text-success me-2">monetization_on</span>
                                Chi phí & Ngân sách
                            </h5>
                            <div class="mb-4">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="text-muted small">Tổng chi phí dự tính</span>
                                    <span class="fw-bold" id="dashboard-total-cost">0 đ</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div id="budget-progress-bar" class="progress-bar bg-success" role="progressbar"
                                        style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="row g-3">
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 text-center border">
                                        <small class="text-muted d-block mb-1">Cost per Hire</small>
                                        <span class="fw-bold text-primary" id="stat-cost-per-hire">0 đ</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 text-center border">
                                        <small class="text-muted d-block mb-1">Tickets Đã Duyệt</small>
                                        <span class="fw-bold text-success" id="stat-approved-tickets">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card border-0 shadow-sm p-4 mb-4 bg-gradient-dark text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-white-50 small text-uppercase mb-2">Tỷ lệ hoàn thành chỉ tiêu</h6>
                                    <h3 class="fw-bold mb-0" id="main-completion-rate">0%</h3>
                                </div>
                                <div class="stat-icon bg-white-20 rounded-circle p-3">
                                    <span class="material-icons-round text-white">task_alt</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PROJECT PERFORMANCE TABLE -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm p-4 mb-4">
                            <h5 class="card-title fw-bold mb-4">
                                <span class="material-icons-round text-warning me-2">folder_special</span>
                                Hiệu suất theo Dự án
                            </h5>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle border-0" id="project-performance-table">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="border-0">DỰ ÁN</th>
                                            <th class="border-0">TRẠNG THÁI</th>
                                            <th class="border-0 text-center">CHỈ TIÊU</th>
                                            <th class="border-0 text-center">ĐÃ RECRUIT</th>
                                            <th class="border-0">TIẾN ĐỘ</th>
                                        </tr>
                                    </thead>
                                    <tbody style="font-size: 0.9rem;">
                                        <!-- Dynamic Content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- END #dashboard -->


            <!-- 2. KANBAN BOARD -->
            <div id="kanban" class="section">
                <div class="card border-0 shadow-sm p-3 w-100 mt-2">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold mb-0 text-muted"
                            style="font-size:0.8rem; text-transform:uppercase; letter-spacing: 0.05em;">
                            <span class="material-icons-round me-1"
                                style="font-size:16px; vertical-align:middle;">filter_list</span>
                            Bộ lọc Kanban
                        </h6>
                        <button class="btn btn-sm btn-glass text-primary d-flex align-items-center gap-1"
                            onclick="resetKanbanFilters()">
                            <span class="material-icons-round" style="font-size: 14px;">restart_alt</span>
                            Làm mới
                        </button>
                    </div>
                    <div class="row g-2">
                        <div class="col-md-3">
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-white border-end-0 text-muted">
                                    <span class="material-icons-round" style="font-size: 18px;">search</span>
                                </span>
                                <input type="text" id="kanban-search-input" class="form-control border-start-0"
                                    placeholder="Tìm tên, SĐT, email..." oninput="renderKanbanBoard()">
                            </div>
                        </div>
                        <div class="col-md-1">
                            <select id="kanban-filter-project" class="form-select form-select-sm"
                                onchange="renderKanbanBoard()">
                                <option value="">Dự án</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <select id="kanban-filter-ticket" class="form-select form-select-sm"
                                onchange="renderKanbanBoard()">
                                <option value="">Ticket</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <select id="kanban-filter-dept" class="form-select form-select-sm"
                                onchange="onKanbanDeptChange()">
                                <option value="">Phòng ban</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <select id="kanban-filter-pos" class="form-select form-select-sm"
                                onchange="renderKanbanBoard()">
                                <option value="">Vị trí</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <select id="kanban-filter-recruiter" class="form-select form-select-sm"
                                onchange="renderKanbanBoard()">
                                <option value="">Người phụ trách</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <div class="input-group input-group-sm">
                                <input type="date" id="kanban-filter-start" class="form-control"
                                    onchange="renderKanbanBoard()">
                                <span class="input-group-text">→</span>
                                <input type="date" id="kanban-filter-end" class="form-control"
                                    onchange="renderKanbanBoard()">
                            </div>
                        </div>
                        <div class="col-md-2 d-flex gap-2">
                            <button class="btn btn-primary btn-sm flex-grow-1" onclick="openCandidateDetail()">
                                <span class="material-icons-round"
                                    style="font-size:16px;vertical-align:middle;">add_circle</span> Thêm CV
                            </button>
                            <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal"
                                data-bs-target="#bulkUploadModal">
                                <span class="material-icons-round"
                                    style="font-size:16px;vertical-align:middle;">upload_file</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Kanban horizontal scroll wrapper -->
                <div style="overflow-x: auto; padding-bottom: 12px; margin: 0 -8px; padding: 0 8px 12px;">
                    <div class="kanban-board" id="kanban-container"
                        style="display: flex; flex-wrap: nowrap; min-width: max-content; gap: 16px; align-items: flex-start;">
                        <!-- Loading spinner (controlled by JS) -->
                        <div class="text-center py-5" id="kanban-loading" style="display: none;">
                            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3 text-muted fw-bold">Đang tải dữ liệu...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. CANDIDATES LIST -->
            <div id="candidates" class="section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h3 class="fw-bold mb-1">
                            <span class="material-icons-round text-primary me-2"
                                style="font-size:28px;vertical-align:middle;">groups</span>
                            Danh sách Ứng viên
                        </h3>
                        <p class="text-muted mb-0">Quản lý và theo dõi thông tin chi tiết của tất cả ứng viên</p>
                    </div>
                    <div class="d-flex gap-2">
                        <div class="input-group" style="width: 300px;">
                            <span class="input-group-text bg-white border-end-0 text-muted">
                                <span class="material-icons-round" style="font-size: 18px;">search</span>
                            </span>
                            <input type="text" id="cand-search-input" class="form-control border-start-0"
                                placeholder="Tìm tên, SĐT, email..." oninput="applyCandidateFilters()">
                        </div>
                        <button class="btn btn-primary d-flex align-items-center gap-2" onclick="openCandidateDetail()">
                            <span class="material-icons-round" style="font-size:20px;">add_circle</span>
                            <span>Thêm Ứng Viên</span>
                        </button>
                        <button class="btn btn-outline-secondary" onclick="loadCandidates()">
                            <span class="material-icons-round" style="font-size: 20px;">refresh</span>
                        </button>
                    </div>
                </div>

                <!-- Candidate Filters -->
                <div class="card border-0 shadow-sm p-3 mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold mb-0 text-muted"
                            style="font-size:0.8rem; text-transform:uppercase; letter-spacing: 0.05em;">
                            <span class="material-icons-round me-1"
                                style="font-size:16px; vertical-align:middle;">filter_list</span>
                            Bộ lọc Ứng viên
                        </h6>
                        <button class="btn btn-sm btn-glass text-primary d-flex align-items-center gap-1"
                            onclick="resetCandidateFilters()">
                            <span class="material-icons-round" style="font-size: 14px;">restart_alt</span>
                            Làm mới
                        </button>
                    </div>
                    <div class="row g-2">
                        <div class="col-md-2">
                            <select id="cand-filter-project" class="form-select form-select-sm"
                                onchange="applyCandidateFilters()">
                                <option value="">Tất cả Dự án</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="cand-filter-ticket" class="form-select form-select-sm"
                                onchange="applyCandidateFilters()">
                                <option value="">Tất cả Ticket</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="cand-filter-dept" class="form-select form-select-sm"
                                onchange="onCandDeptChange()">
                                <option value="">Phòng ban</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="cand-filter-pos" class="form-select form-select-sm"
                                onchange="applyCandidateFilters()">
                                <option value="">Tất cả vị trí</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="cand-filter-recruiter" class="form-select form-select-sm"
                                onchange="applyCandidateFilters()">
                                <option value="">Người phụ trách</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="cand-filter-status" class="form-select form-select-sm"
                                onchange="applyCandidateFilters()">
                                <option value="">Tất cả trạng thái</option>
                                <option value="ung tuyen">Ứng tuyển</option>
                                <option value="so van">Sơ vấn</option>
                                <option value="phong van">Phỏng vấn</option>
                                <option value="moi nhan viec">Mời nhận việc</option>
                                <option value="nhan viec">Đã nhận việc</option>
                                <option value="tu choi">Từ chối</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <div class="input-group input-group-sm">
                                <input type="date" id="cand-filter-start" class="form-control"
                                    onchange="applyCandidateFilters()">
                                <span class="input-group-text">→</span>
                                <input type="date" id="cand-filter-end" class="form-control"
                                    onchange="applyCandidateFilters()">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle" id="candidates-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Họ Tên</th>
                                        <th>Vị trí</th>
                                        <th>Ngày ứng tuyển</th>
                                        <th>Trạng thái</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data rows go here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EVALUATIONS SECTION -->
            <div id="evaluations" class="section">
                <div class="section-header-modern mb-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="icon-box-gradient">
                            <span class="material-icons-round">fact_check</span>
                        </div>
                        <div>
                            <h4 class="fw-bold mb-0">Quản lý Đánh giá Phỏng vấn</h4>
                            <p class="text-muted small mb-0">Theo dõi, phê duyệt và thực hiện quy trình đánh giá ứng
                                viên
                            </p>
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-tech" type="button" onclick="openCreateEvaluationModal()">
                            <span class="material-icons-round me-1">add_circle</span>
                            <span>Tạo Phiếu Đánh giá</span>
                        </button>
                        <button class="btn btn-glass icon-only" type="button" onclick="loadEvaluations()">
                            <span class="material-icons-round">refresh</span>
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-glass icon-only" type="button" data-bs-toggle="dropdown">
                                <span class="material-icons-round">more_vert</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                                <li><a class="dropdown-item text-danger d-flex align-items-center gap-2" href="#"
                                        onclick="confirmResetEvaluationSheet()">
                                        <span class="material-icons-round" style="font-size:18px;">restart_alt</span>
                                        Reset
                                        Sheet (Admin)
                                    </a></li>
                                <li><a class="dropdown-item d-flex align-items-center gap-2" href="#"
                                        onclick="google.script.run.withSuccessHandler(res => Swal.fire({title: 'DEBUG', html: '<pre style=\'text-align:left;font-size:10px\'>' + res + '</pre>', width: '800px'})).debugSheetData()">
                                        <span class="material-icons-round" style="font-size:18px;">bug_report</span>
                                        Debug
                                        Data
                                    </a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle" id="evaluations-table">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Ứng viên</th>
                                        <th>Vị trí</th>
                                        <th>Người đánh giá</th>
                                        <th>Trạng thái</th>
                                        <th>Kết quả</th>
                                        <th>Ngày tạo</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data rows go here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- JOBS SECTION -->
            <div id="jobs" class="section">
                <div class="section-header-modern mb-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="icon-box-gradient">
                            <span class="material-icons-round">campaign</span>
                        </div>
                        <div>
                            <h4 class="fw-bold mb-0">Tin Tuyển Dụng</h4>
                            <p class="text-muted small mb-0">Quản lý các vị trí đang mở và nội dung đăng tuyển</p>
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-tech" data-bs-toggle="modal" data-bs-target="#addJobModal">
                            <span class="material-icons-round me-1">add</span>
                            <span>Tạo Tin Mới</span>
                        </button>
                        <button class="btn btn-glass icon-only" onclick="loadJobs()">
                            <span class="material-icons-round">refresh</span>
                        </button>
                    </div>
                </div>
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle" id="jobs-table">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Vị trí</th>
                                        <th>Phòng ban</th>
                                        <th>Địa điểm</th>
                                        <th>Ngày tạo</th>
                                        <th>Trạng thái</th>
                                        <th>Hành động</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RECRUITMENT HUB (Merged Projects & Tickets) -->
            <div id="recruitment-hub" class="section">
                <div class="glass-card mb-4">
                    <div class="card-header bg-transparent border-0 p-3 pb-0">
                        <ul class="nav nav-pills glass-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#hub-projects">
                                    <span class="material-icons-round">account_tree</span>
                                    <span>Dự án Tuyển dụng</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#hub-tickets">
                                    <span class="material-icons-round">confirmation_number</span>
                                    <span>Phiếu yêu cầu (Tickets)</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="tab-content">
                    <!-- PROJECTS TAB -->
                    <div class="tab-pane fade show active" id="hub-projects">
                        <div class="section-header-modern mb-4">
                            <div class="d-flex align-items-center gap-3">
                                <div class="icon-box-gradient">
                                    <span class="material-icons-round">folder_special</span>
                                </div>
                                <div>
                                    <h4 class="fw-bold mb-0">Quản lý Dự án</h4>
                                    <p class="text-muted small mb-0">Theo dõi ngân sách và tiến độ các chiến dịch tuyển
                                        dụng
                                    </p>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-tech" onclick="openProjectModal()">
                                    <span class="material-icons-round me-1">add</span> Tạo Dự án
                                </button>
                                <button class="btn btn-glass icon-only" onclick="loadProjects()">
                                    <span class="material-icons-round">refresh</span>
                                </button>
                            </div>
                        </div>
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0" id="projects-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="ps-3">Mã Dự án</th>
                                                <th>Tên Dự án</th>
                                                <th>Đã tuyển / Số lượng</th>
                                                <th>Chi phí / Ngân sách</th>
                                                <th>Quản lý</th>
                                                <th>Ngày bắt đầu</th>
                                                <th>Ngày kết thúc</th>
                                                <th>Trạng thái</th>
                                                <th class="pe-3 text-center">Thao tác</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TICKETS TAB -->
                    <div class="tab-pane fade" id="hub-tickets">
                        <div class="section-header-modern mb-4">
                            <div class="d-flex align-items-center gap-3">
                                <div class="icon-box-gradient">
                                    <span class="material-icons-round">receipt_long</span>
                                </div>
                                <div>
                                    <h4 class="fw-bold mb-0">Phiếu yêu cầu Tuyển dụng</h4>
                                    <p class="text-muted small mb-0">Theo dõi yêu cầu nhân sự từ các phòng ban</p>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-tech" onclick="openTicketModal()">
                                    <span class="material-icons-round me-1">add_circle</span> Tạo Yêu cầu
                                </button>
                                <button class="btn btn-glass icon-only" onclick="loadTickets()">
                                    <span class="material-icons-round">refresh</span>
                                </button>
                            </div>
                        </div>
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0" id="tickets-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="ps-3">Mã Ticket</th>
                                                <th>Vị trí</th>
                                                <th class="text-center">Đã tuyển / Số lượng</th>
                                                <th>Chi phí</th>
                                                <th>Dự án</th>
                                                <th>Ngày bắt đầu</th>
                                                <th>Deadline</th>
                                                <th>Trạng thái</th>
                                                <th class="pe-3">Thao tác</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 7. CALENDAR SECTION -->
            <div id="calendar-section" class="section">
                <div class="card border-0 shadow-sm">
                    <div class="card-header border-0 d-flex justify-content-between align-items-center"
                        style="background: var(--gradient-tech); padding: 1.25rem 1.5rem;">
                        <h5 class="mb-0 fw-bold text-white d-flex align-items-center gap-2">
                            <span class="material-icons-round">calendar_month</span>
                            Lịch Phỏng Vấn Tuyển Dụng
                        </h5>
                        <button class="btn btn-sm btn-light text-primary fw-bold d-flex align-items-center gap-1"
                            onclick="showSection('calendar-section', document.getElementById('nav-calendar'))">
                            <span class="material-icons-round" style="font-size: 18px;">refresh</span>
                            <span>Cập nhật</span>
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="calendar-container" style="overflow: hidden; border-radius: 0 0 5px 5px;">
                            <iframe
                                src="https://calendar.google.com/calendar/embed?src=b4a01a2123b4134ecadfc6178e645a47acaa5653478befa66693b0859de28602%40group.calendar.google.com&ctz=Asia%2FHo_Chi_Minh"
                                style="border: 0" width="100%" height="600" frameborder="0" scrolling="no">
                            </iframe>
                            <div class="mt-2 text-muted small italic">
                                <span class="material-icons-outlined"
                                    style="font-size:14px;vertical-align:middle;">info</span>
                                Lưu ý: Nếu không thấy
                                lịch, vui lòng đảm bảo bạn đã
                                được cấp quyền truy cập hoặc lịch đã được để ở chế độ Công khai (Public).
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS SECTION -->
            <div id="settings" class="section">
                <div class="section-header-modern mb-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="icon-box-gradient">
                            <span class="material-icons-round">settings_suggest</span>
                        </div>
                        <div>
                            <h4 class="fw-bold mb-0">Cài Đặt Hệ Thống</h4>
                            <p class="text-muted small mb-0">Cấu hình danh mục, quy trình và thông tin vận hành</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card mb-4">
                    <div class="card-header bg-transparent border-0 p-3 pb-0">
                        <ul class="nav nav-pills glass-tabs" id="settingsTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-departments">
                                    <span class="material-icons-round">apartment</span>
                                    <span>Vị trí & Phòng ban</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-users">
                                    <span class="material-icons-round">group</span>
                                    <span>Users</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-recruiters">
                                    <span class="material-icons-round">badge</span>
                                    <span>Recruiters</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-email">
                                    <span class="material-icons-round">alternate_email</span>
                                    <span>Email</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-news">
                                    <span class="material-icons-round">newspaper</span>
                                    <span>Tin tức</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-sources">
                                    <span class="material-icons-round">share</span>
                                    <span>Nguồn ứng viên</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-company">
                                    <span class="material-icons-round">business_center</span>
                                    <span>Công ty</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#tab-rejection">
                                    <span class="material-icons-round">block</span>
                                    <span>Loại ứng viên</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2 text-danger" data-bs-toggle="tab"
                                    href="#tab-cleanup">
                                    <span class="material-icons-round">cleaning_services</span>
                                    <span>Database</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body p-4">
                        <div class="tab-content">
                            <!-- RECRUITERS TAB -->
                            <div class="tab-pane fade" id="tab-recruiters">
                                <div class="d-flex justify-content-between mb-3">
                                    <h5>Quản lý Người phụ trách (Recruiters)</h5>
                                    <button class="btn btn-sm btn-info text-white" onclick="promptAddRecruiter()">
                                        <span class="material-icons-outlined"
                                            style="font-size:16px;vertical-align:middle;">person_add</span> Thêm Người
                                        phụ trách
                                    </button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="recruiters-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 50px;">ID</th>
                                                <th>Họ tên</th>
                                                <th>Email</th>
                                                <th>Chức vụ</th>
                                                <th>Ngày tham gia</th>
                                                <th class="text-center">Tổng ứng viên</th>
                                                <th class="text-center" style="width: 120px;">Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Recruiters will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- DEPARTMENTS TAB -->
                            <div class="tab-pane fade show active" id="tab-departments">
                                <div class="d-flex justify-content-between mb-3">
                                    <h5>Quản lý Phòng ban & Vị trí công việc</h5>
                                    <button class="btn btn-sm btn-primary" onclick="promptAddDepartment()">
                                        <span class="material-icons-outlined"
                                            style="font-size:16px;vertical-align:middle;">add</span> Thêm Phòng ban
                                    </button>
                                </div>
                                <div id="departments-container" class="row g-3">
                                    <!-- Department cards will be injected here -->
                                </div>
                            </div>

                            <!-- USERS TAB -->
                            <div class="tab-pane fade" id="tab-users">
                                <div class="d-flex justify-content-between mb-3">
                                    <h5>Danh sách người dùng</h5>
                                    <button class="btn btn-sm btn-success" onclick="openUserModal()">
                                        <span class="material-icons-outlined"
                                            style="font-size:16px;vertical-align:middle;">person_add</span> Thêm User
                                    </button>
                                </div>
                                <table class="table table-bordered" id="users-table">
                                    <thead>
                                        <tr>
                                            <th>Username</th>
                                            <th>Họ tên</th>
                                            <th>Email</th>
                                            <th>SĐT</th>
                                            <th>Vai trò</th>
                                            <th>Phòng ban</th>
                                            <th>Hành động</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>


                            <!-- EMAIL TAB -->
                            <div class="tab-pane fade" id="tab-email">
                                <div class="row">
                                    <div class="col-md-4">
                                        <button class="btn btn-success w-100 mb-2" onclick="addEmailTemplate()">
                                            <span class="material-icons-outlined"
                                                style="font-size:16px;vertical-align:middle;">add</span> Thêm Mẫu Mới
                                        </button>
                                        <div class="list-group" id="email-template-list">
                                            <!-- Dynamically populated -->
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <form id="email-template-form" style="display:none;">
                                            <h5 id="template-editor-title">Chỉnh sửa mẫu</h5>
                                            <input type="hidden" id="tpl-id">
                                            <div class="mb-3">
                                                <label class="form-label">Tên mẫu (Hiển thị trong danh sách)</label>
                                                <input type="text" class="form-control" id="tpl-name"
                                                    placeholder="Ví dụ: Thư mời phỏng vấn">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Tiêu đề Email</label>
                                                <input type="text" class="form-control" id="tpl-subject">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Nội dung</label>
                                                <textarea class="form-control" id="tpl-body" rows="10"></textarea>
                                                <small class="text-muted">Có thể dùng các biến: {{name}}, {{position}},
                                                    {{date}}</small>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <button type="button" class="btn btn-danger"
                                                    onclick="deleteEmailTemplate()">
                                                    <span class="material-icons-outlined"
                                                        style="font-size:16px;vertical-align:middle;">delete</span> Xóa
                                                </button>
                                                <button type="button" class="btn btn-primary"
                                                    onclick="saveEmailTemplate()">
                                                    <span class="material-icons-outlined"
                                                        style="font-size:16px;vertical-align:middle;">save</span> Lưu
                                                    Mẫu
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NEWS TAB -->
                    <div class="tab-pane fade" id="tab-news">
                        <div class="d-flex justify-content-between mb-3">
                            <h5>Quản lý Tin Tức</h5>
                            <button class="btn btn-sm btn-primary" onclick="openNewsModal()">
                                <span class="material-icons-outlined"
                                    style="font-size:16px;vertical-align:middle;">add</span>
                                Viết Bài Mới
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover" id="news-table">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 50px;">ID</th>
                                        <th style="width: 60px;">Img</th>
                                        <th>Tiêu đề</th>
                                        <th>Ngày đăng</th>
                                        <th>Trạng thái</th>
                                        <th class="text-center" style="width: 150px;">Hành động</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tab-sources">
                        <div class="d-flex justify-content-between mb-3">
                            <h5>Quản lý Nguồn Ứng Viên</h5>
                            <div class="input-group" style="width: 400px;">
                                <input type="text" class="form-control" id="new-source-name"
                                    placeholder="Nhập tên nguồn mới...">
                                <button class="btn btn-success" onclick="addCandidateSource()">
                                    <span class="material-icons-outlined"
                                        style="font-size:16px;vertical-align:middle;">add</span> Thêm
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover" id="sources-table">
                                <thead class="table-light">
                                    <tr>
                                        <th>Tên nguồn</th>
                                        <th class="text-center" style="width: 100px;">Hành động</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- COMPANY INFO TAB -->
                    <div class="tab-pane fade" id="tab-company">
                        <div class="d-flex justify-content-between mb-3 align-items-center">
                            <h5>Thông tin Công ty</h5>
                            <button class="btn btn-primary" onclick="saveCompanyInfo()">
                                <span class="material-icons-outlined"
                                    style="font-size:16px;vertical-align:middle;">save</span>
                                Lưu thông tin
                            </button>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Tên công ty</label>
                                <input type="text" class="form-control" id="comp-name"
                                    placeholder="Ví dụ: Công ty TNHH ABC">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold">Mã số thuế</label>
                                <input type="text" class="form-control" id="comp-taxcode" placeholder="0101234567">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold">Email công ty</label>
                                <input type="email" class="form-control" id="comp-email" placeholder="hr@abc.com">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label fw-bold">Số điện thoại</label>
                                <input type="text" class="form-control" id="comp-phone" placeholder="024 1234 5678">
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label fw-bold mb-0">Danh sách Địa chỉ</label>
                                    <button class="btn btn-sm btn-outline-success" onclick="addCompanyAddress()">
                                        <span class="material-icons-outlined"
                                            style="font-size:16px;vertical-align:middle;">add</span> Thêm địa chỉ
                                    </button>
                                </div>
                                <div id="comp-addresses-container" class="vstack gap-2">
                                    <!-- Dynamic address rows -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label fw-bold mb-0">Người ký hợp đồng / Đại diện</label>
                                    <button class="btn btn-sm btn-outline-success" onclick="addCompanySigner()">
                                        <span class="material-icons-outlined"
                                            style="font-size:16px;vertical-align:middle;">add</span> Thêm người ký
                                    </button>
                                </div>
                                <div id="comp-signers-container" class="vstack gap-2">
                                    <!-- Dynamic signer rows -->
                                </div>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label fw-bold">Thời gian làm việc</label>
                                <textarea class="form-control" id="comp-worktime" rows="2"
                                    placeholder="Ví dụ: Thứ 2 - Thứ 6: 08:30 - 17:30"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- REJECTION REASONS TAB -->
                    <div class="tab-pane fade" id="tab-rejection">
                        <div class="d-flex justify-content-between mb-3 align-items-center">
                            <h5>Quản lý Lý do Từ chối</h5>
                            <button class="btn btn-primary" onclick="saveRejectionReasons()">
                                <span class="material-icons-outlined"
                                    style="font-size:16px;vertical-align:middle;">save</span>
                                Lưu cấu hình
                            </button>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card border border-primary-subtle shadow-none">
                                    <div
                                        class="card-header bg-primary-subtle d-flex justify-content-between align-items-center">
                                        <span class="fw-bold text-primary">Công ty từ chối ứng viên</span>
                                        <button class="btn btn-xs btn-primary"
                                            onclick="addRejectionReasonRow('Company')">
                                            <span class="material-icons-outlined"
                                                style="font-size:14px;vertical-align:middle;">add</span> Thêm lý do
                                        </button>
                                    </div>
                                    <div class="card-body p-2">
                                        <div id="rejection-company-list" class="vstack gap-2">
                                            <!-- Rows injected here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border border-warning-subtle shadow-none">
                                    <div
                                        class="card-header bg-warning-subtle d-flex justify-content-between align-items-center">
                                        <span class="fw-bold text-warning-emphasis">Ứng viên từ chối Công ty</span>
                                        <button class="btn btn-xs btn-warning"
                                            onclick="addRejectionReasonRow('Candidate')">
                                            <span class="material-icons-outlined"
                                                style="font-size:14px;vertical-align:middle;">add</span> Thêm lý do
                                        </button>
                                    </div>
                                    <div class="card-body p-2">
                                        <div id="rejection-candidate-list" class="vstack gap-2">
                                            <!-- Rows injected here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CLEANUP TAB -->
                    <div class="tab-pane fade" id="tab-cleanup">
                        <div class="alert alert-warning">
                            <h5 class="alert-heading"><span class="material-icons-outlined"
                                    style="font-size:20px;vertical-align:middle;">warning</span> Công cụ dọn dẹp hệ
                                thống</h5>
                            <p>Công cụ này sẽ thực hiện các tác vụ sau:</p>
                            <ul>
                                <li>Hợp nhất dữ liệu từ các cột trùng lặp (ví dụ: <code>Contact_Status</code> vào
                                    <code>Tình trạng liên hệ</code>).
                                </li>
                                <li>Chuyển đổi dữ liệu từ cột tạm <code>Newnote</code> vào lịch sử ghi chú chính.</li>
                                <li>Xóa bỏ các cột thừa để Google Sheet gọn nhẹ và hoạt động nhanh hơn.</li>
                            </ul>
                            <hr>
                            <p class="mb-0 text-danger"><strong>Lưu ý:</strong> Hành động này sẽ thay đổi cấu trúc
                                Google Sheet. Hãy đảm bảo không có ai đang chỉnh sửa trực tiếp file Sheet khi thực hiện.
                            </p>
                        </div>
                        <div class="text-center py-4">
                            <button class="btn btn-danger btn-lg" onclick="runDatabaseCleanup()">
                                <span class="material-icons-outlined"
                                    style="font-size:18px;vertical-align:middle;">auto_fix_high</span> Bắt đầu Dọn dẹp
                                &amp; Tối ưu ngay
                            </button>
                            <div id="cleanup-loader" class="mt-3" style="display:none;">
                                <div class="spinner-border text-danger" role="status"></div>
                                <p class="mt-2 text-muted">Đang xử lý dữ liệu, vui lòng đợi...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RECRUITER MODAL (Add/Edit) -->
    <div class="modal fade" id="recruiterModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center">
                        <span class="material-icons-round me-2">person_pin</span>Người phụ trách
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="recruiter-form">
                        <input type="hidden" id="rec-id">
                        <div class="mb-3">
                            <label class="form-label">Họ và tên <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="rec-name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="rec-email">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Chức vụ</label>
                            <input type="text" class="form-control" id="rec-position">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ngày tham gia</label>
                            <input type="date" class="form-control" id="rec-joinDate">
                        </div>
                    </form>
                </div>
                <div class="modal-footer modal-footer-custom">
                    <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary px-5 fw-bold" onclick="saveRecruiter()">
                        <span class="material-icons-round me-2">save</span>Lưu thông tin
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- MODAL: ADD JOB -->
    <div class="modal fade" id="addJobModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center">
                        <span class="material-icons-round me-2">post_add</span>Tạo Tin Tuyển Dụng
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-job-form">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Tiêu đề</label>
                                <input type="text" class="form-control" name="title" id="job-title" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phòng ban</label>
                                <select class="form-select" name="department" id="job-dept"
                                    onchange="onJobDepartmentChange()">
                                    <option value="">-- Chọn Phòng ban --</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Vị trí cụ thể</label>
                                <select class="form-select" name="position" id="job-position">
                                    <option value="">-- Chọn Vị trí --</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Địa điểm</label>
                                <select class="form-select" name="location" id="job-location">
                                    <option value="">-- Chọn Địa điểm --</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Loại hình</label>
                                <select class="form-select" name="type" id="job-type">
                                    <option value="FullTime">FullTime</option>
                                    <option value="Parttime">Parttime</option>
                                    <option value="Intern">Intern</option>
                                    <option value="Freelance">Freelance</option>
                                    <option value="Khác">Khác</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label fw-bold text-primary">Liên kết với Yêu cầu tuyển dụng
                                    (Ticket)</label>
                                <select class="form-select border-primary" name="ticketId" id="job-ticket-id">
                                    <option value="">-- Chọn Ticket đã tạo --</option>
                                </select>
                                <div class="form-text">Gắn JD vào Ticket để AI có thể tự động chấm điểm ứng viên
                                    thuộc
                                    Ticket này.</div>
                            </div>
                            <div class="col-12">
                                <label class="form-label d-flex justify-content-between align-items-center">
                                    Mô tả công việc
                                    <button type="button"
                                        class="btn btn-sm btn-light text-primary border shadow-sm px-2 py-1"
                                        onclick="handleGenerateJD()">
                                        <span class="material-icons-outlined"
                                            style="font-size:16px;vertical-align:middle;">auto_awesome</span> AI
                                        Soạn JD
                                    </button>
                                </label>
                                <textarea class="form-control" name="description" id="job-description" rows="8"
                                    placeholder="Nhập yêu cầu cơ bản rồi nhấn AI Soạn JD để mở rộng..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer modal-footer-custom">
                    <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary btn-primary-custom px-5 fw-bold" onclick="saveJob()">
                        <span class="material-icons-round me-2">save</span>Lưu Tin Tuyển Dụng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: VIEW JOB DETAILS (ADMIN) -->
    <div class="modal fade" id="viewJobModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center" id="view-job-title">
                        <span class="material-icons-round me-2">visibility</span>Chi Tiết Công Việc
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Phòng ban:</strong> <span id="view-job-dept"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Đia điểm:</strong> <span id="view-job-loc"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Loại hình:</strong> <span id="view-job-type"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Trạng thái:</strong> <span id="view-job-status"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Ngày tạo:</strong> <span id="view-job-date"></span>
                        </div>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <h6 class="fw-bold">Mô tả công việc:</h6>
                        <div id="view-job-desc" class="p-3 bg-light rounded" style="white-space: pre-wrap;"></div>
                    </div>
                </div>
                <div class="modal-footer modal-footer-custom">
                    <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary px-5 fw-bold" id="btn-edit-from-view">
                        <span class="material-icons-round me-2">edit</span>Chỉnh sửa
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: ADD/EDIT USER -->
    <div class="modal fade" id="addUserModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center" id="userModalLabel">
                        <span class="material-icons-round me-2">person_add</span>Quản lý Người Dùng
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="user-form">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Username <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="u-username" required>
                                <input type="hidden" id="u-mode" value="add">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Password <span class="text-danger"
                                        id="u-password-req">*</span></label>
                                <input type="password" class="form-control" id="u-password">
                                <small class="text-muted" id="u-password-hint" style="display:none">Để trống nếu
                                    không
                                    đổi</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Họ tên <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="u-fullname" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="u-email">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Số điện thoại</label>
                                <input type="text" class="form-control" id="u-phone">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Vai trò <span class="text-danger">*</span></label>
                                <select class="form-select" id="u-role">
                                    <option value="User">User</option>
                                    <option value="Viewer">Viewer</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Manager">Manager</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Phòng ban</label>
                                <select class="form-select" id="u-department">
                                    <option value="All">All</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer modal-footer-custom">
                    <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary px-5 fw-bold" onclick="saveUser()">
                        <span class="material-icons-round me-2">save</span>Lưu Người Dùng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: CANDIDATE DETAILS -->
    <div class="modal fade" id="candidateDetailModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center">
                        <span class="material-icons-round me-2" style="font-size: 24px;">person</span>Chi Tiết Ứng
                        Viên
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-0">
                    <div class="modal-lg-scroll p-4">
                        <!-- Modern Tabs Navigation -->
                        <ul class="nav nav-pills glass-tabs mb-4" id="candidateTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#info-pane">
                                    <span class="material-icons-round">account_circle</span>Thông tin chung
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#career-pane">
                                    <span class="material-icons-round">work</span>Hồ sơ tuyển dụng
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#schedule-pane">
                                    <span class="material-icons-round">event_available</span>Lịch hẹn & Đánh giá
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                    href="#notes-pane">
                                    <span class="material-icons-round">sticky_note_2</span>Ghi chú
                                </a>
                            </li>
                        </ul>

                        <form id="edit-candidate-form">
                            <input type="hidden" id="current-candidate-id">
                            <div class="tab-content" id="candidateTabContent">
                                <!-- Tab 1: Thông tin chung -->
                                <div class="tab-pane fade show active" id="info-pane">
                                    <div class="form-section-title"><span class="material-icons-outlined"
                                            style="font-size:18px;vertical-align:middle;">person</span> Thông tin cá
                                        nhân
                                    </div>
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Họ tên ứng viên <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control form-control" id="detail-name"
                                                required placeholder="Nhập đầy đủ họ tên">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Giới tính</label>
                                            <select class="form-select form-control" id="detail-gender">
                                                <option value="">- Chọn -</option>
                                                <option>Nam</option>
                                                <option>Nữ</option>
                                                <option>Khác</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Năm sinh</label>
                                            <input type="number" class="form-control form-control" id="detail-dob"
                                                placeholder="YYYY">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Số điện thoại <span
                                                    class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <input type="tel" class="form-control form-control" id="detail-phone"
                                                    required placeholder="090...">
                                                <span class="material-icons-outlined"
                                                    style="font-size:16px;">phone</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Email <span
                                                    class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <input type="email" class="form-control form-control" id="detail-email"
                                                    required placeholder="email@example.com">
                                                <span class="material-icons-outlined"
                                                    style="font-size:16px;">mail</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-section-title mt-5"><span class="material-icons-outlined"
                                            style="font-size:18px;vertical-align:middle;">school</span> Học vấn &
                                        Chuyên môn</div>
                                    <div class="row g-4">
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Tên trường</label>
                                            <input type="text" class="form-control form-control" id="detail-school"
                                                placeholder="VD: Đại học Kinh tế">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Trình độ học vấn</label>
                                            <select class="form-select form-control" id="detail-education-level">
                                                <option value="">Chọn trình độ</option>
                                                <option>Dưới THPT</option>
                                                <option>THPT</option>
                                                <option>Trung cấp</option>
                                                <option>Cao Đẳng</option>
                                                <option>Đại học</option>
                                                <option>Sau đại học</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Chuyên ngành</label>
                                            <input type="text" class="form-control form-control" id="detail-major"
                                                placeholder="VD: Marketing">
                                        </div>
                                        <div class="col-md-12">
                                            <label class="form-label fw-bold">Kinh nghiệm làm việc</label>
                                            <textarea class="form-control form-control" id="detail-experience" rows="2"
                                                placeholder="Tóm tắt kinh nghiệm..."></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 2: Hồ sơ tuyển dụng -->
                                <div class="tab-pane fade" id="career-pane">
                                    <div class="form-section-title"><span class="material-icons-outlined"
                                            style="font-size:18px;vertical-align:middle;">gps_fixed</span> Vị trí &
                                        Trạng
                                        thái
                                    </div>
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Phòng ban <span
                                                    class="text-danger">*</span></label>
                                            <select class="form-select form-control" id="detail-department"
                                                onchange="populatePositionDropdown()">
                                                <option value="">Chọn phòng ban</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Vị trí ứng tuyển <span
                                                    class="text-danger">*</span></label>
                                            <select class="form-select form-control" id="detail-position">
                                                <option>Chọn vị trí</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Nhân viên tuyển dụng <span
                                                    class="text-danger">*</span></label>
                                            <select class="form-select form-control" id="detail-recruiter">
                                                <option>Chọn nhân viên</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Nguồn ứng viên</label>
                                            <select class="form-select form-control" id="detail-source">
                                                <option value="">Chọn nguồn (Đang tải...)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Trạng thái (Quy trình) <span
                                                    class="text-danger">*</span></label>
                                            <select class="form-select form-control" id="detail-status"></select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Tình trạng liên hệ</label>
                                            <select class="form-select form-control" id="detail-contact-status">
                                                <option>Mới tiếp nhận</option>
                                                <option>Đã liên lạc</option>
                                                <option>Đang trao đổi</option>
                                                <option>Chờ phản hồi</option>
                                                <option>Không nghe máy</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Thuộc yêu cầu (Ticket)</label>
                                            <select class="form-select form-control" id="detail-ticket-id">
                                                <option value="">-- Không có --</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Lương mong muốn (VNĐ)</label>
                                            <input type="text" class="form-control form-control" id="detail-salary"
                                                placeholder="VD: 15.000.000">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold text-muted">Ngày ứng tuyển</label>
                                            <input type="text" class="form-control form-control bg-light"
                                                id="detail-applied-date" readonly>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold text-muted">Người tạo hồ sơ</label>
                                            <input type="text" class="form-control form-control bg-light"
                                                id="detail-creator" readonly>
                                        </div>

                                        <!-- Tracking fields (Hire/Reject) -->
                                        <div class="col-md-12 hire-tracking-field" style="display:none;">
                                            <div class="alert alert-success d-flex align-items-center mb-0 py-2">
                                                <span class="material-icons-round me-2">check_circle</span>
                                                <div><strong>Ngày nhận việc:</strong> <span
                                                        id="detail-hire-date-text">--/--/----</span></div>
                                                <input type="hidden" id="detail-hire-date">
                                            </div>
                                        </div>

                                        <div class="col-md-3 rejection-tracking-field" style="display:none;">
                                            <label class="form-label fw-bold text-danger">Đối tượng từ chối</label>
                                            <select class="form-select form-control border-danger"
                                                id="detail-rejection-source">
                                                <option value="">-- Chọn --</option>
                                                <option value="Company">Công ty từ chối</option>
                                                <option value="Candidate">Ứng viên từ chối</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 rejection-tracking-field" style="display:none;"
                                            id="rejection-type-container">
                                            <label class="form-label fw-bold text-danger">Loại từ chối</label>
                                            <select class="form-select form-control border-danger"
                                                id="detail-rejection-type"></select>
                                        </div>
                                        <div class="col-md-3 rejection-tracking-field" style="display:none;"
                                            id="rejection-stage-container">
                                            <label class="form-label fw-bold text-danger">Giai đoạn từ chối</label>
                                            <select class="form-select form-control border-danger"
                                                id="detail-rejection-stage">
                                                <option value="">-- Chọn bước --</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 rejection-tracking-field" style="display:none;"
                                            id="rejection-reason-container">
                                            <label class="form-label fw-bold text-danger">Lý do chi tiết</label>
                                            <input type="text" class="form-control form-control border-danger"
                                                id="detail-rejection-reason">
                                        </div>
                                    </div>

                                    <div class="form-section-title mt-5"><span class="material-icons-outlined"
                                            style="font-size:18px;vertical-align:middle;">description</span> Quản lý
                                        Hồ
                                        sơ
                                        CV
                                    </div>
                                    <div class="bg-light p-4 rounded-4 border border-dashed">
                                        <div class="row align-items-center g-3">
                                            <div class="col-md-8">
                                                <input type="text" class="form-control form-control" id="detail-cv-link"
                                                    placeholder="Nhập link CV hoặc upload file...">
                                            </div>
                                            <div class="col-md-4 d-flex gap-2">
                                                <button class="btn btn-outline-info flex-grow-1" type="button"
                                                    id="btn-view-cv-detail"><span class="material-icons-outlined"
                                                        style="font-size:16px;vertical-align:middle;">visibility</span>
                                                    Xem</button>
                                                <button class="btn btn-outline-warning flex-grow-1" type="button"
                                                    id="btn-ai-parse" onclick="handleAIParsing()"><span
                                                        class="material-icons-outlined"
                                                        style="font-size:16px;vertical-align:middle;">smart_toy</span>
                                                    AI
                                                    Parse</button>
                                            </div>
                                            <div class="col-12 mt-2">
                                                <input type="file" class="d-none" id="detail-cv-file"
                                                    accept=".pdf,.doc,.docx,.jpg,.png">
                                                <button class="btn btn-primary w-100" type="button"
                                                    onclick="document.getElementById('detail-cv-file').click()"><span
                                                        class="material-icons-outlined me-2"
                                                        style="font-size:16px;vertical-align:middle;">cloud_upload</span>Tải
                                                    hồ sơ lên hệ thống</button>
                                            </div>
                                        </div>
                                        <div id="ai-loading" class="text-info mt-3" style="display:none;">
                                            <small><span class="material-icons-outlined"
                                                    style="font-size:14px;vertical-align:middle;">hourglass_top</span>
                                                Hệ
                                                thống AI đang phân tích hồ
                                                sơ, vui lòng chờ giây lát...</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 3: Lịch hẹn & Đánh giá -->
                                <div class="tab-pane fade" id="schedule-pane">
                                    <div class="row g-4">
                                        <div class="col-md-6 border-end">
                                            <div class="form-section-title"><span class="material-icons-outlined"
                                                    style="font-size:18px;vertical-align:middle;">schedule</span>
                                                Thiết
                                                lập
                                                Lịch
                                                phỏng vấn</div>
                                            <div class="card border-0 bg-light p-4 rounded-4">
                                                <div class="mb-3">
                                                    <label class="form-label small fw-bold">Thời gian bắt
                                                        đầu</label>
                                                    <input type="datetime-local" class="form-control form-control"
                                                        id="interview-start">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label small fw-bold">Thời gian kết
                                                        thúc</label>
                                                    <input type="datetime-local" class="form-control form-control"
                                                        id="interview-end">
                                                </div>
                                                <div class="mb-4">
                                                    <label class="form-label small fw-bold">Email Manager phụ
                                                        trách</label>
                                                    <input type="email" class="form-control form-control"
                                                        id="interview-manager-email" placeholder="manager@company.com">
                                                </div>
                                                <button
                                                    class="btn btn-primary btn-action-lg w-100 justify-content-center"
                                                    type="button" onclick="handleCreateSchedule()">
                                                    <span class="material-icons-outlined"
                                                        style="font-size:16px;vertical-align:middle;">send</span>
                                                    Gửi
                                                    Mail
                                                    Mời Phỏng Vấn
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-6 px-lg-5">
                                            <div class="form-section-title"><span class="material-icons-outlined"
                                                    style="font-size:18px;vertical-align:middle;">star</span> Kết
                                                quả
                                                Đánh
                                                giá
                                            </div>
                                            <div class="text-center py-5">
                                                <span class="material-icons-outlined"
                                                    style="font-size:64px;color:#e0e0e0;">assignment</span>
                                                <p class="text-muted">Bạn có thể tạo yêu cầu đánh giá cho Manager
                                                    sau
                                                    khi
                                                    buổi phỏng vấn kết thúc.</p>
                                                <button type="button"
                                                    class="btn btn-outline-success btn-action-lg mx-auto"
                                                    id="btn-request-eval" onclick="openCreateEvaluationModal()">
                                                    <span class="material-icons-outlined"
                                                        style="font-size:16px;vertical-align:middle;">add_circle</span>
                                                    Tạo
                                                    yêu cầu Đánh giá
                                                </button>
                                            </div>
                                        </div>
                                        <!-- AI MATCHING SECTION -->
                                        <div class="col-12">
                                            <div class="mt-4 p-4 border rounded-4 bg-light shadow-sm"
                                                id="ai-match-section">
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <h6 class="text-primary mb-0"><span
                                                            class="material-icons-outlined me-2"
                                                            style="font-size:18px;vertical-align:middle;">psychology</span>Phân
                                                        tích
                                                        độ phù hợp (AI Matching)</h6>
                                                    <button type="button"
                                                        class="btn btn-sm btn-primary px-3 rounded-pill"
                                                        onclick="startAiMatching()">
                                                        <span class="material-icons-outlined"
                                                            style="font-size:16px;vertical-align:middle;">play_arrow</span>
                                                        Phân tích ngay
                                                    </button>
                                                </div>

                                                <div class="d-flex align-items-center mb-3">
                                                    <div class="progress flex-grow-1 rounded-pill"
                                                        style="height: 12px;">
                                                        <div id="ai-score-bar"
                                                            class="progress-bar progress-bar-striped progress-bar-animated"
                                                            style="width: 0%"></div>
                                                    </div>
                                                    <span id="ai-score-text"
                                                        class="ms-3 fw-bold fs-5 text-primary">0%</span>
                                                </div>

                                                <div class="row g-3 small">
                                                    <div class="col-md-6">
                                                        <div
                                                            class="p-3 bg-white rounded-3 border-start border-success border-4 h-100">
                                                            <strong class="text-success d-block mb-2"><span
                                                                    class="material-icons-outlined"
                                                                    style="font-size:16px;vertical-align:middle;">check_circle</span>
                                                                Điểm mạnh</strong>
                                                            <ul id="ai-pros" class="mb-0 ps-3"></ul>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div
                                                            class="p-3 bg-white rounded-3 border-start border-danger border-4 h-100">
                                                            <strong class="text-danger d-block mb-2"><span
                                                                    class="material-icons-outlined"
                                                                    style="font-size:16px;vertical-align:middle;">cancel</span>
                                                                Điểm yếu</strong>
                                                            <ul id="ai-cons" class="mb-0 ps-3"></ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div
                                                    class="mt-3 p-3 bg-white rounded-3 border-start border-info border-4">
                                                    <p id="ai-summary" class="mb-0 text-muted fst-italic">Chưa có dữ
                                                        liệu
                                                        phân tích.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 4: Ghi chú -->
                                <div class="tab-pane fade" id="notes-pane">
                                    <div class="form-section-title"><span class="material-icons-outlined"
                                            style="font-size:18px;vertical-align:middle;">history</span> Lịch sử
                                        hoạt
                                        động
                                    </div>

                                    <!-- Rejection Quick Info Highlight -->
                                    <div id="rejection-info-summary" class="alert alert-danger mb-4 shadow-sm"
                                        style="display:none; border-radius: 12px; border-left: 5px solid var(--accent-rose);">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h6 class="mb-0 fw-bold d-flex align-items-center">
                                                <span class="material-icons-round me-2">report_problem</span>
                                                THÔNG TIN TỪ CHỐI
                                            </h6>
                                            <span class="badge bg-danger" id="summary-rejection-stage">Giai đoạn:
                                                N/A</span>
                                        </div>
                                        <div class="row g-2" style="font-size: 0.9rem;">
                                            <div class="col-md-6">
                                                <span class="text-muted small d-block">Đối tượng & Loại:</span>
                                                <span class="fw-bold" id="summary-rejection-source-type">Company -
                                                    N/A</span>
                                            </div>
                                            <div class="col-md-6 text-md-end">
                                                <span class="text-muted small d-block">Lý do chi tiết:</span>
                                                <span class="fw-bold" id="summary-rejection-reason">N/A</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="detail-notes-history" class="mb-4">
                                        <!-- Notes list will be rendered here -->
                                    </div>
                                    <div class="form-section-title mt-4"><span class="material-icons-outlined"
                                            style="font-size:18px;vertical-align:middle;">add_comment</span> Thêm
                                        ghi
                                        chú
                                        mới</div>
                                    <textarea class="form-control form-control" id="detail-new-note" rows="3"
                                        placeholder="Nhập ghi chú quan trọng tại đây... (Dùng @ để nhắc tên đồng nghiệp)"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer modal-footer-custom">
                        <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">Đóng</button>
                        <div class="ms-auto d-flex gap-2">
                            <button type="button" class="btn btn-info text-white px-4 fw-bold"
                                onclick="exportCandidateToPDF()">
                                <span class="material-icons-outlined me-2"
                                    style="font-size:16px;vertical-align:middle;">picture_as_pdf</span> Xuất Profile
                            </button>
                            <button type="button" class="btn btn-warning text-dark px-4 fw-bold"
                                onclick="openDocumentHub()">
                                <span class="material-icons-outlined me-2"
                                    style="font-size:16px;vertical-align:middle;">edit_document</span> Cập nhật Hợp đồng
                            </button>
                            <button type="button" class="btn btn-primary px-5 fw-bold" id="btn-save-candidate"
                                onclick="saveCandidate()">
                                <span class="material-icons-outlined me-2"
                                    style="font-size:16px;vertical-align:middle;">save</span> Lưu Hồ Sơ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL: DOCUMENT HUB (AUTO GENERATE PDF) -->
        <div class="modal fade" id="documentHubModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content modal-content-premium">
                    <div class="modal-header modal-header-tech">
                        <h5 class="modal-title fw-bold d-flex align-items-center">
                            <span class="material-icons-round me-2">edit_document</span>Trung tâm Tạo Văn bản
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-4">
                            <label class="form-label fw-bold">Chọn loại văn bản cần tạo</label>
                            <select class="form-select form-control" id="doc-template-select"
                                onchange="toggleDocExtraFields()">
                                <option value="TemplateOffer">Thư mời nhận việc (Offer Letter)</option>
                                <option value="TemplateContractProbation">Hợp đồng thử việc (Probation)</option>
                                <option value="TemplateContractOfficial">Hợp đồng lao động (Official)</option>
                                <option value="TemplateCandidateProfile">Hồ sơ khảo sát (Profile Summary)</option>
                            </select>
                        </div>

                        <!-- Extra fields for documents -->
                        <div id="doc-extra-fields" class="glass-card p-4">
                            <h6 class="fw-bold mb-3 d-flex align-items-center gap-2">
                                <span class="material-icons-round text-primary"
                                    style="font-size: 20px;">contact_page</span>
                                Thông tin bổ sung
                            </h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Số văn bản (Ghi đè)</label>
                                    <input type="text" class="form-control" id="doc-number-override"
                                        placeholder="Ví dụ: 123/2024">
                                </div>
                                <div class="col-md-6" id="field-salary">
                                    <label class="form-label">Mức lương (VNĐ)</label>
                                    <input type="text" class="form-control" id="doc-salary"
                                        placeholder="Ví dụ: 15,000,000">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Lương bằng chữ (Đồng)</label>
                                    <input type="text" class="form-control" id="doc-salary-words"
                                        placeholder="Ví dụ: Mười lăm triệu">
                                </div>
                                <div class="col-md-6" id="field-start-date">
                                    <label class="form-label">Ngày bắt đầu</label>
                                    <input type="date" class="form-control" id="doc-start-date">
                                </div>
                                <div class="col-md-6" id="field-probation-end">
                                    <label class="form-label">Ngày kết thúc thử việc</label>
                                    <input type="date" class="form-control" id="doc-probation-end">
                                </div>
                                <div class="col-md-6" id="field-deadline">
                                    <label class="form-label">Hạn phản hồi</label>
                                    <input type="date" class="form-control" id="doc-deadline">
                                </div>
                                <div class="col-md-6" id="field-contract-period">
                                    <label class="form-label">Thời hạn hợp đồng</label>
                                    <input type="text" class="form-control" id="doc-contract-period"
                                        placeholder="Ví dụ: 12 tháng">
                                </div>
                                <div class="col-md-6" id="field-issuance-location">
                                    <label class="form-label">Địa điểm lập văn bản</label>
                                    <input type="text" class="form-control" id="doc-issuance-location"
                                        placeholder="Ví dụ: Hà Nội">
                                </div>
                                <div class="col-12" id="field-manager">
                                    <label class="form-label">Người báo cáo trực tiếp</label>
                                    <input type="text" class="form-control" id="doc-manager"
                                        placeholder="Tên và chức vụ">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Địa điểm làm việc</label>
                                    <select class="form-select" id="doc-location-select">
                                        <option value="">-- Chọn địa điểm --</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Người ký / Đại diện</label>
                                    <select class="form-select" id="doc-signer-select">
                                        <option value="">-- Chọn người ký --</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div id="doc-loading" class="text-center mt-3" style="display:none;">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p class="mt-2 text-muted">Đang xử lý PDF, vui lòng đợi...</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                        <button type="button" class="btn btn-success" id="btn-generate-doc"
                            onclick="generateDocument()">
                            <span class="material-icons-outlined"
                                style="font-size:16px;vertical-align:middle;">auto_awesome</span> Tạo & Xuất File
                            PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL: SEND EMAIL (SMART GMAIL STYLE) -->
        <div class="modal fade" id="sendEmailModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content modal-content-premium">
                    <div class="modal-header modal-header-tech py-3">
                        <h6 class="modal-title fw-bold d-flex align-items-center">
                            <span class="material-icons-round me-2">mail</span>Soạn thư mới
                        </h6>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-0">
                        <form id="send-email-form">
                            <input type="hidden" id="email-candidate-id">

                            <!-- Recipients -->
                            <div class="border-bottom px-3 py-2">
                                <div class="d-flex align-items-center mb-1">
                                    <span class="text-muted me-2" style="width: 40px;">Đến</span>
                                    <input type="text" class="form-control border-0 p-0 shadow-none" id="email-to"
                                        readonly style="background: transparent;">
                                    <div class="ms-auto">
                                        <small class="text-primary cursor-pointer me-2"
                                            onclick="toggleEmailField('cc')">Cc</small>
                                        <small class="text-primary cursor-pointer"
                                            onclick="toggleEmailField('bcc')">Bcc</small>
                                    </div>
                                </div>

                                <div id="email-cc-container" style="display: none;"
                                    class="d-flex align-items-baseline mb-1">
                                    <span class="text-muted me-2" style="width: 40px;">Cc</span>
                                    <div class="recipient-tags-input flex-grow-1 border-0 p-0 shadow-none"
                                        id="email-cc-tags">
                                        <input type="text" class="border-0 shadow-none flex-grow-1" id="email-cc-input"
                                            placeholder="Thêm CC..." onkeydown="handleRecipientInput(event, 'cc')">
                                    </div>
                                </div>

                                <div id="email-bcc-container" style="display: none;"
                                    class="d-flex align-items-baseline mb-1">
                                    <span class="text-muted me-2" style="width: 40px;">Bcc</span>
                                    <div class="recipient-tags-input flex-grow-1 border-0 p-0 shadow-none"
                                        id="email-bcc-tags">
                                        <input type="text" class="border-0 shadow-none flex-grow-1" id="email-bcc-input"
                                            placeholder="Thêm BCC..." onkeydown="handleRecipientInput(event, 'bcc')">
                                    </div>
                                </div>
                            </div>

                            <!-- Template & Subject -->
                            <div class="border-bottom px-3 py-2 d-flex align-items-center">
                                <select class="form-select form-select-sm border-0 border-end shadow-none me-2"
                                    id="email-template-select" style="width: 150px; background: transparent;"
                                    onchange="loadTemplateContent(this.value)">
                                    <option value="">-- Mẫu --</option>
                                </select>
                                <input type="text" class="form-control border-0 p-0 shadow-none" id="email-subject"
                                    placeholder="Tiêu đề">
                            </div>

                            <!-- Rich Text Editor -->
                            <div class="email-editor-container border-0">
                                <div id="email-body-quill"></div>
                            </div>

                            <!-- Attachments Preview -->
                            <div id="email-attachments-list" class="px-3 py-2 border-top bg-light"
                                style="display: none;">
                                <!-- Badges will appear here -->
                            </div>
                        </form>
                    </div>
                    <!-- Bottom Toolbar -->
                    <div class="modal-footer justify-content-start border-top-0 px-3 py-2">
                        <div class="btn-group dropup">
                            <button type="button" class="btn btn-primary px-4" id="btn-send-email"
                                onclick="sendEmail()">Gửi</button>
                            <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                <span class="visually-hidden">Thêm tùy chọn</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="openScheduleSendModal()"><span
                                            class="material-icons-outlined me-2"
                                            style="font-size:16px;vertical-align:middle;">schedule_send</span>Hẹn
                                        giờ
                                        gửi</a></li>
                            </ul>
                        </div>

                        <button class="btn btn-light btn-sm text-secondary p-2 ms-2" title="Đính kèm tệp"
                            onclick="document.getElementById('email-attachment-input').click()">
                            <span class="material-icons-outlined" style="font-size:18px;">attach_file</span>
                        </button>
                        <input type="file" id="email-attachment-input" multiple style="display: none;"
                            onchange="handleFileAttachments(this)">

                        <button class="btn btn-light btn-sm text-secondary p-2" title="Chèn liên kết"
                            onclick="quill.theme.tooltip.edit()">
                            <span class="material-icons-outlined" style="font-size:18px;">link</span>
                        </button>

                        <button class="btn btn-light btn-sm text-secondary p-2" title="Bản nháp" onclick="saveDraft()">
                            <span class="material-icons-outlined" style="font-size:18px;">save</span>
                        </button>

                        <div class="ms-auto">
                            <small class="text-muted" id="email-draft-status">Đã lưu tự động lúc 00:00</small>
                            <button class="btn btn-light btn-sm text-secondary p-2 ms-2" title="Xóa thư nháp"
                                onclick="clearDraft()">
                                <span class="material-icons-outlined" style="font-size:18px;">delete_outline</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- JAVASCRIPT -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- Quill.js JS -->
        <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

        <!-- MODAL: NEWS (Add/Edit) -->
        <div class="modal fade" id="newsModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content modal-content-premium">
                    <div class="modal-header modal-header-tech">
                        <h5 class="modal-title fw-bold d-flex align-items-center">
                            <span class="material-icons-round me-2">newspaper</span>Quản lý Tin Tức
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="news-form">
                            <input type="hidden" id="news-id">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Tiêu đề bài viết <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="news-title" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Hình ảnh bài viết</label>
                                <input type="file" class="form-control" id="news-image-db" multiple accept="image/*"
                                    onchange="previewNewsFlagNodes()">
                                <input type="hidden" id="news-image">
                                <!-- To store existing URLs or uploaded URLs -->
                                <div id="news-image-preview" class="d-flex flex-wrap gap-2 mt-2">
                                </div>
                                <small class="text-muted">Đang dùng chế độ: Upload ảnh trực tiếp lên
                                    Server.</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Nội dung</label>
                                <textarea class="form-control" id="news-content" rows="8"
                                    placeholder="Nội dung bài viết..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Trạng thái</label>
                                <select class="form-select" id="news-status">
                                    <option value="Published">Đã đăng (Published)</option>
                                    <option value="Draft">Bản nháp (Draft)</option>
                                    <option value="Hidden">Ẩn (Hidden)</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                        <button type="button" class="btn btn-primary" onclick="saveNews()">
                            <span class="material-icons-outlined"
                                style="font-size:16px;vertical-align:middle;">save</span>
                            Lưu Bài Viết
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- MODAL: BULK UPLOAD CANDIDATES -->
    <div class="modal fade" id="bulkUploadModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center">
                        <span class="material-icons-round me-2">cloud_upload</span>Tải Hồ Sơ Hàng Loạt
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Modern Tabs -->
                    <ul class="nav nav-pills glass-tabs mb-4" id="bulkUploadTabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active d-flex align-items-center gap-2" data-bs-toggle="tab"
                                data-bs-target="#tab-cvs">
                                <span class="material-icons-round">picture_as_pdf</span>File CV
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="tab"
                                data-bs-target="#tab-sheet">
                                <span class="material-icons-round">table_chart</span>Excel / Sheet
                            </a>
                        </li>
                    </ul>

                    <div class="tab-content" id="bulkUploadTabsContent">

                        <!-- TAB 1: UPLOAD CV FILES -->
                        <div class="tab-pane fade show active" id="tab-cvs" role="tabpanel">
                            <form id="bulk-upload-form">
                                <div class="mb-3">
                                    <label class="form-label">Chọn hồ sơ (PDF, Docx)</label>
                                    <input type="file" class="form-control" id="bulk-files" multiple
                                        accept=".pdf,.doc,.docx">
                                    <div class="form-text">Có thể chọn nhiều file cùng lúc (Tối đa 5
                                        file/lần).</div>
                                </div>
                            </form>
                        </div>

                        <!-- TAB 2: IMPORT EXCEL/SHEET -->
                        <div class="tab-pane fade" id="tab-sheet" role="tabpanel">
                            <form id="sheet-import-form">
                                <div class="mb-3">
                                    <label class="form-label">Chọn phương thức nhập:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="importType" id="import-url"
                                            value="URL" checked onchange="toggleImportInputs()">
                                        <label class="form-check-label" for="import-url">
                                            Link Google Sheet
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="importType" id="import-file"
                                            value="FILE" onchange="toggleImportInputs()">
                                        <label class="form-check-label" for="import-file">
                                            File Excel (.xlsx)
                                        </label>
                                    </div>
                                </div>

                                <div class="mb-3" id="input-url-container">
                                    <label class="form-label">Dán Link Google Sheet</label>
                                    <input type="text" class="form-control" id="sheet-url"
                                        placeholder="https://docs.google.com/spreadsheets/d/...">
                                    <div class="form-text text-warning"><span class="material-icons-outlined"
                                            style="font-size:14px;vertical-align:middle;">warning</span> Hãy
                                        chắc chắn file Google Sheet đã được chia sẻ quyền truy cập (Anyone
                                        with link
                                        hoặc share cho email sở hữu script).</div>
                                </div>

                                <div class="mb-3 d-none" id="input-file-container">
                                    <label class="form-label">Chọn file Excel hoặc CSV</label>
                                    <input type="file" class="form-control" id="sheet-file" accept=".xlsx, .csv">
                                    <div class="form-text">Khuyên dùng file <b>.csv</b> nếu import Excel bị
                                        lỗi.</div>
                                </div>
                            </form>
                        </div>

                    </div>

                    <hr>
                    <!-- COMMON SETTINGS -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nguồn ứng viên</label>
                            <select class="form-select" id="bulk-source">
                                <option value="Bulk Import">Bulk Import</option>
                                <option value="Website">Website</option>
                                <option value="LinkedIn">LinkedIn</option>
                                <option value="Referral">Referral</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Giai đoạn</label>
                            <select class="form-select" id="bulk-stage">
                                <option value="Ứng tuyển">Ứng tuyển</option>
                                <option value="New">Mới</option>
                            </select>
                        </div>
                    </div>

                    <div id="bulk-upload-progress" class="d-none">
                        <hr>
                        <h6>Tiến độ:</h6>
                        <div class="progress mb-2">
                            <div id="bulk-progress-bar"
                                class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                                role="progressbar" style="width: 0%"></div>
                        </div>
                        <div id="bulk-status-text" class="small text-muted">Đang xử lý...</div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" onclick="handleImportAction()">
                        <span class="material-icons-outlined me-1"
                            style="font-size:16px;vertical-align:middle;">cloud_upload</span> Bắt đầu Import
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: CV PREVIEW -->
    <div class="modal fade" id="cvPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered" style="height: 90vh;">
            <div class="modal-content modal-content-premium h-100">
                <div class="modal-header modal-header-tech py-3">
                    <h5 class="modal-title fs-6 fw-bold d-flex align-items-center">
                        <span class="material-icons-round me-2">picture_as_pdf</span>Xem CV Ứng Viên
                    </h5>
                    <div class="ms-auto d-flex align-items-center gap-2">
                        <a href="#" id="cv-download-btn" target="_blank"
                            class="btn btn-sm btn-glass text-white border-white">
                            <span class="material-icons-round" style="font-size: 16px;">open_in_new</span>
                        </a>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                </div>
                <div class="modal-body p-0" style="background: #e9ecef;">
                    <iframe id="cv-iframe" src="" style="width: 100%; height: 100%; border: none;"></iframe>
                </div>
            </div>
        </div>
    </div>
    <!-- MODAL: REQUEST EVALUATION (Legacy/Contextual) -->
    <div class="modal fade" id="requestEvaluationModal" tabindex="-1" data-bs-backdrop="static"
        data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Yêu cầu Đánh giá</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="req-eval-candidate-id">
                    <div class="mb-3">
                        <label class="form-label">Người đánh giá (Manager) *</label>
                        <select class="form-select" id="req-eval-manager">
                            <option value="">Chọn Manager</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" onclick="submitEvaluationRequest()">
                        <span class="material-icons-outlined" style="font-size:16px;vertical-align:middle;">send</span>
                        Gửi Yêu cầu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: CREATE EVALUATION (Direct) -->
    <div class="modal fade" id="createEvaluationModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center">
                        <span class="material-icons-round me-2">add_task</span> Tạo Phiếu Đánh giá Mới
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Chọn Ứng viên *</label>
                        <select class="form-select" id="create-eval-candidate">
                            <option value="">-- Tìm kiếm ứng viên --</option>
                        </select>
                        <small class="text-muted">Chỉ hiển thị ứng viên đang ở vòng Phỏng vấn.</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Người đánh giá (Manager) *</label>
                        <div id="manager-select-container">
                            <div class="input-group mb-2 manager-row">
                                <select class="form-select manager-select">
                                    <option value="">-- Chọn Manager --</option>
                                </select>
                                <button class="btn btn-outline-danger remove-manager" type="button"
                                    style="display:none;"><span class="material-icons-outlined"
                                        style="font-size:16px;">close</span></button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary" id="btn-add-manager"
                            onclick="addManagerInput()">
                            <span class="material-icons-outlined"
                                style="font-size:16px;vertical-align:middle;">person_add</span> Thêm người đánh giá (Tối
                            đa 3)
                        </button>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Tiêu chí Đánh giá</label>
                        <div id="criteria-container">
                            <!-- Default criteria will be added here via JS -->
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-info" onclick="addCriteriaInput()">
                            <span class="material-icons-outlined"
                                style="font-size:16px;vertical-align:middle;">add</span> Thêm tiêu chí khác
                        </button>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="create-eval-now">
                        <label class="form-check-label" for="create-eval-now">
                            Tôi muốn đánh giá ngay bây giờ
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" onclick="submitCreateEvaluation()">
                        <span class="material-icons-outlined" style="font-size:16px;vertical-align:middle;">check</span>
                        Tạo Phiếu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: DO EVALUATION (For Manager) -->
    <div class="modal fade" id="doEvaluationModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content modal-content-premium">
                <div class="modal-header modal-header-tech">
                    <h5 class="modal-title fw-bold d-flex align-items-center">
                        <span class="material-icons-round me-2">rate_review</span> Đánh giá Phỏng vấn
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="do-eval-id">
                    <div class="alert alert-light border shadow-sm">
                        <div class="row">
                            <div class="col-md-6">
                                <strong><span class="material-icons-outlined"
                                        style="font-size:16px;vertical-align:middle;">school</span> Ứng viên:</strong>
                                <span id="do-eval-cname" class="fw-bold text-primary"></span> <br>
                                <strong><span class="material-icons-outlined"
                                        style="font-size:16px;vertical-align:middle;">work</span> Vị trí:</strong> <span
                                    id="do-eval-position"></span>
                            </div>
                            <div class="col-md-6 border-start">
                                <strong><span class="material-icons-outlined"
                                        style="font-size:16px;vertical-align:middle;">person</span> Người đánh
                                    giá:</strong> <span id="do-eval-mgr-name"></span> <br>
                                <strong><span class="material-icons-outlined"
                                        style="font-size:16px;vertical-align:middle;">badge</span> Chức vụ:</strong>
                                <span id="do-eval-mgr-pos"></span> (<span id="do-eval-mgr-dept"></span>)
                            </div>
                        </div>
                    </div>

                    <form id="evaluation-form">
                        <div id="dynamic-scores-container" class="row mb-3">
                            <!-- Scores will be rendered here (1-10 scale) -->
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold"><span class="material-icons-outlined text-danger"
                                        style="font-size:16px;vertical-align:middle;">calculate</span> Tổng
                                    điểm trung bình</label>
                                <div class="input-group">
                                    <input type="text" class="form-control fw-bold text-danger bg-light"
                                        id="eval-total-score" readonly value="0">
                                    <span class="input-group-text">/ 10</span>
                                </div>
                                <small class="text-muted" id="eval-score-label">Chưa đánh giá</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold"><span class="material-icons-outlined text-success"
                                        style="font-size:16px;vertical-align:middle;">payments</span>
                                    Mức lương đề xuất</label>
                                <input type="text" class="form-control" id="eval-proposed-salary"
                                    placeholder="VD: 15.000.000 VNĐ">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Nhận xét chi tiết <span
                                    class="text-danger">*</span></label>
                            <textarea class="form-control" id="eval-comment" rows="4"
                                placeholder="Nhập nhận xét về điểm mạnh, điểm yếu..."></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Kết quả cuối cùng <span
                                    class="text-danger">*</span></label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="eval-result" id="res-pass" value="Pass"
                                    autocomplete="off">
                                <label class="btn btn-outline-success" for="res-pass">PASS (Đạt)</label>

                                <input type="radio" class="btn-check" name="eval-result" id="res-consider"
                                    value="Consider" autocomplete="off">
                                <label class="btn btn-outline-warning" for="res-consider">CONSIDER (Cân
                                    nhắc)</label>

                                <input type="radio" class="btn-check" name="eval-result" id="res-reject" value="Reject"
                                    autocomplete="off">
                                <label class="btn btn-outline-danger" for="res-reject">REJECT (Loại)</label>
                            </div>
                        </div>

                        <div class="alert alert-info border-info mt-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="eval-signature-confirm">
                                <label class="form-check-label fw-bold" for="eval-signature-confirm">
                                    Xác nhận hoàn thành và ký điện tử phiếu đánh giá này
                                </label>
                                <div class="small text-muted">Tôi xác nhận các thông tin đánh giá trên là
                                    chính xác và
                                    chịu trách nhiệm về nội dung này.</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-success" onclick="submitEvaluation()">
                        <span class="material-icons-outlined"
                            style="font-size:16px;vertical-align:middle;">check_circle</span> Hoàn thành Đánh giá
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- MODAL: ADD/EDIT PROJECT -->
    <div class="modal fade" id="projectModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold"><span class="material-icons-outlined me-2"
                            style="font-size:20px;vertical-align:middle;">account_tree</span>Thiết lập Dự
                        án Tuyển
                        dụng</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Project Statistics (Top Row) -->
                    <div id="proj-stats-container" class="mb-4" style="display:none;">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                                    <div class="text-primary fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.75rem;">Số lượng Ticket</div>
                                    <div class="h3 mb-0 fw-bold text-primary" id="stat-proj-tickets">0</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">
                                    <div class="text-warning fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.75rem;">Tổng SL Cần</div>
                                    <div class="h3 mb-0 fw-bold text-warning" id="stat-proj-requested">0
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);">
                                    <div class="text-success fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.75rem;">Tổng Đã tuyển</div>
                                    <div class="h3 mb-0 fw-bold text-success" id="stat-proj-hired">0</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);">
                                    <div class="text-secondary fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.75rem;">Tổng Chi phí</div>
                                    <div class="h4 mb-0 fw-bold text-secondary" id="stat-proj-cost">0 đ
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tickets List (Moved Up) -->
                    <div id="proj-tickets-list-container" class="mb-4" style="display:none;">
                        <label class="form-label fw-bold mb-2 text-primary"><span class="material-icons-outlined me-2"
                                style="font-size:16px;vertical-align:middle;">list</span>Chi tiết
                            các Ticket trong Dự án</label>
                        <div class="table-responsive border rounded-3 bg-white shadow-sm">
                            <table class="table table-sm table-hover mb-0 align-middle" style="font-size: 0.85rem;">
                                <thead style="background-color: #f8f9fa;">
                                    <tr>
                                        <th class="ps-3 py-2">Vị trí</th>
                                        <th class="text-center">Số lượng</th>
                                        <th class="text-center">Đã tuyển</th>
                                        <th>Deadline</th>
                                        <th>Chi phí</th>
                                        <th>Trạng thái</th>
                                    </tr>
                                </thead>
                                <tbody id="proj-tickets-tbody">
                                    <!-- Rows injected here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <form id="project-form">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label fw-bold">Tên Dự án <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="proj-name" required
                                    placeholder="VD: Tuyển dụng Khối Công nghệ Q3/2026">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">Mã Dự án</label>
                                <input type="text" class="form-control bg-light" id="proj-code" readonly
                                    placeholder="Tự động tạo">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label fw-bold">Ngày bắt đầu</label>
                                <input type="date" class="form-control" id="proj-start">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label fw-bold">Ngày kết thúc</label>
                                <input type="date" class="form-control" id="proj-end">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label fw-bold">Chỉ tiêu (Người)</label>
                                <input type="number" class="form-control" id="proj-quota" placeholder="VD: 5">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label fw-bold">Ngân sách (VNĐ)</label>
                                <input type="number" class="form-control" id="proj-budget" placeholder="VD: 50.000.000">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Quản trị Dự án</label>
                            <select class="form-select" id="proj-manager">
                                <option value="Admin">Admin</option>
                            </select>
                        </div>

                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label class="form-label fw-bold mb-0">Quy trình Tuyển dụng (Các bước phỏng
                                vấn)</label>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addProjectStage()">
                                <span class="material-icons-outlined"
                                    style="font-size:16px;vertical-align:middle;">add</span> Thêm bước
                            </button>
                        </div>
                        <div id="project-stages-container" class="vstack gap-2 border p-3 rounded bg-light mb-4"
                            style="max-height: 200px; overflow-y: auto;">
                            <!-- Stage items will be injected here -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary px-4 fw-bold" onclick="saveProject()">Lưu
                        Dự
                        án</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: CREATE RECRUITMENT TICKET -->
    <div class="modal fade" id="ticketModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title fw-bold"><span class="material-icons-outlined me-2"
                            style="font-size:20px;vertical-align:middle;">confirmation_number</span>Tạo Phiếu Yêu cầu
                        Tuyển dụng
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Ticket Statistics Area (Sync with Project Style) -->
                    <div id="ticket-stats-container" class="mb-4" style="display:none;">
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                                    <div class="text-primary fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.7rem;">SỐ LƯỢNG TUYỂN</div>
                                    <div class="h4 mb-0 fw-bold text-primary" id="stat-hired-ratio">0/0
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);">
                                    <div class="text-success fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.7rem;">CHI PHÍ ĐÃ CHI</div>
                                    <div class="h5 mb-0 fw-bold text-success" id="stat-total-costs">0 đ
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">
                                    <div class="text-warning fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.7rem;">DEADLINE</div>
                                    <div class="h4 mb-0 fw-bold text-warning" id="stat-days-left">0</div>
                                    <small class="text-warning-emphasis" style="font-size: 0.6rem;">ngày
                                        nữa</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm text-center p-3 h-100"
                                    style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);">
                                    <div class="text-purple fw-bold small text-uppercase mb-1"
                                        style="font-size: 0.7rem; color: #7b1fa2;">HIỆU QUẢ (%)</div>
                                    <div class="h4 mb-0 fw-bold" style="color: #7b1fa2;" id="stat-efficiency-perc">0%
                                    </div>
                                    <small class="text-muted" style="font-size: 0.55rem;">(Đúng hạn/Yêu
                                        cầu)</small>
                                </div>
                            </div>
                        </div>

                        <!-- Hired Candidates List Section -->
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-white py-2">
                                <h6 class="fw-bold mb-0 text-dark"><span class="material-icons-outlined me-2"
                                        style="font-size:16px;vertical-align:middle;">group</span>Ứng viên đã
                                    nhận việc</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0" style="font-size: 0.85rem;"
                                        id="hired-candidates-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="ps-3 border-0">STT</th>
                                                <th class="border-0">Ứng viên</th>
                                                <th class="border-0">Ngày nhận việc</th>
                                                <th class="border-0">Tình trạng</th>
                                                <th class="pe-3 text-center border-0">Thao tác</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Recruiter Efficiency -->
                        <div class="row g-2">
                            <div class="col-md-12">
                                <small class="text-muted d-block mb-2 fw-bold"
                                    style="font-size: 0.7rem; text-transform: uppercase;">Chi tiết hiệu suất
                                    Recruiter</small>
                                <div id="stat-recruiter-performance" class="vstack gap-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Approval Section (New) -->
                    <div id="admin-approval-section" class="alert alert-info border-0 mb-4" style="display:none;">
                        <h6 class="fw-bold mb-3"><span class="material-icons-outlined me-2"
                                style="font-size:16px;vertical-align:middle;">admin_panel_settings</span>Phê duyệt
                            Ticket
                            (Admin Only)
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label small fw-bold">Phân công Recruiter</label>
                                <select class="form-select form-select-sm" id="tick-admin-recruiter">
                                    <option value="">-- Chọn Recruiter --</option>
                                </select>
                            </div>
                            <div class="col-md-6 text-end d-flex align-items-end justify-content-end gap-2">
                                <button class="btn btn-sm btn-success px-3"
                                    onclick="approveTicketAction('Approved')">Duyệt</button>
                                <button class="btn btn-sm btn-danger px-3" onclick="approveTicketAction('Rejected')">Từ
                                    chối</button>
                            </div>
                            <div class="col-12">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label small fw-bold mb-0">Quản lý Chi phí</label>
                                    <button class="btn btn-sm btn-link text-decoration-none p-0" onclick="addCostRow()">
                                        <span class="material-icons-outlined"
                                            style="font-size:16px;vertical-align:middle;">add</span> Thêm chi phí
                                    </button>
                                </div>
                                <div id="tick-costs-container" class="vstack gap-2">
                                    <!-- Dynamic cost rows -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <form id="ticket-form">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label fw-bold">Thuộc Dự án <span class="text-danger">*</span></label>
                                <select class="form-select" id="tick-project" required>
                                    <option value="">-- Chọn Dự án --</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Số lượng tuyển <span
                                        class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="tick-quantity" value="1" min="1">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Phòng ban <span class="text-danger">*</span></label>
                                <select class="form-select" id="tick-department" required>
                                    <option value="">-- Chọn Phòng ban --</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Vị trí cần tuyển <span
                                        class="text-danger">*</span></label>
                                <select class="form-select" id="tick-position" required>
                                    <option value="">-- Chọn Vị trí --</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label fw-bold text-primary">Ngày bắt đầu</label>
                                <input type="date" class="form-control" id="tick-start">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold text-danger">Deadline <span
                                        class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="tick-deadline">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Loại hình làm việc</label>
                                <select class="form-select" id="tick-work-type">
                                    <option value="Fulltime">Fulltime</option>
                                    <option value="Parttime">Parttime</option>
                                    <option value="Intern">Intern</option>
                                    <option value="Freelance">Freelance</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">Học vấn</label>
                                <select class="form-select" id="tick-education">
                                    <option value="Không yêu cầu">Không yêu cầu</option>
                                    <option value="THPT">THPT</option>
                                    <option value="Trung cấp">Trung cấp</option>
                                    <option value="Cao đẳng">Cao đẳng</option>
                                    <option value="Đại học">Đại học</option>
                                    <option value="Sau đại học">Sau đại học</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Giới tính</label>
                                <select class="form-select" id="tick-gender">
                                    <option value="Không yêu cầu">Không yêu cầu</option>
                                    <option value="Nam">Nam</option>
                                    <option value="Nữ">Nữ</option>
                                </select>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label">Tuổi</label>
                                    <input type="text" class="form-control" id="tick-age" placeholder="VD: 22-35">
                                </div>
                                <div class="col-md-8 d-flex align-items-end">
                                    <button type="button" class="btn btn-outline-info w-100"
                                        id="btn-view-jd-from-ticket" onclick="viewLinkedJD()">
                                        <span class="material-icons-outlined me-1"
                                            style="font-size:16px;vertical-align:middle;">open_in_new</span> Xem JD chi
                                        tiết liên kết
                                    </button>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Chuyên môn</label>
                                    <input type="text" class="form-control" id="tick-major">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Kinh nghiệm</label>
                                    <select class="form-select" id="tick-experience">
                                        <option value="Không yêu cầu">Không yêu cầu</option>
                                        <option value="Dưới 1 năm">Dưới 1 năm</option>
                                        <option value="1-2 năm">Từ 1 đến dưới 2 năm</option>
                                        <option value="2-3 năm">Từ 2 đến dưới 3 năm</option>
                                        <option value="3-5 năm">Từ 3 đến 5 năm</option>
                                        <option value="Trên 5 năm">Trên 5 năm</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Văn phòng làm việc</label>
                                    <select class="form-select" id="tick-office">
                                        <option value="">-- Chọn văn phòng --</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Quản lý trực tiếp</label>
                                    <input type="text" class="form-control" id="tick-manager">
                                </div>
                            </div>
                    </form>
                </div>
                <div class="modal-footer pb-4">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-warning px-4 fw-bold" id="btn-propose-edit"
                        onclick="saveTicket()" style="display:none;">Đề xuất chỉnh sửa</button>
                    <button type="button" class="btn btn-success px-4 fw-bold" id="btn-save-ticket"
                        onclick="saveTicket()">Gửi Yêu cầu</button>
                </div>
            </div>
        </div>
    </div>
    <!-- (END OF app-container content) -->

    </div> <!-- END app-container -->

    <!-- CHATBOT AI UI (Moved out of container for better visibility) -->
    <div id="chat-circle" class="btn rounded-circle shadow-lg"
        style="position:fixed; bottom:30px; right:30px; width:60px; height:60px; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10000; transition: all 0.3s ease; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border: none;">
        <span class="material-icons-outlined" style="font-size: 28px; color: white;">smart_toy</span>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="chat-badge"
            style="display:none;">1</span>
    </div>

    <div id="chat-box" class="card shadow-2xl border-0 animate__animated"
        style="position:fixed; bottom:110px; right:30px; width:380px; height:550px; display:none; z-index:10000; flex-direction:column; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center p-3 border-0">
            <div class="d-flex align-items-center">
                <div class="rounded-circle d-flex align-items-center justify-content-center me-3"
                    style="width:40px; height:40px; background: rgba(255,255,255,0.2);">
                    <span class="material-icons-outlined" style="color: white;">smart_toy</span>
                </div>
                <div>
                    <h6 class="mb-0 fw-bold">Trợ lý Tuyển dụng</h6>
                    <small class="opacity-75" style="font-size: 0.7rem;">● Đang hoạt động</small>
                </div>
            </div>
            <button type="button" class="btn-close btn-close-white shadow-none" onclick="toggleChat()"></button>
        </div>
        <div id="chat-content" class="card-body overflow-auto p-4"
            style="flex-grow:1; background:#f0f2f5; scroll-behavior: smooth;">
            <div class="d-flex flex-column align-items-start mb-4">
                <div class="msg-ai shadow-sm p-3 rounded-4 bg-white" style="border-bottom-left-radius: 5px !important;">
                    Chào anh/chị, em là Trợ lý AI! 🤖<br>
                    Em có thể giúp anh/chị tra cứu ứng viên, soạn JD hoặc viết email. Cần gì cứ bảo em nhé!
                </div>
                <small class="text-muted mt-1 ms-2" style="font-size: 10px;">AI • Vừa xong</small>
            </div>
        </div>
        <div class="card-footer bg-white p-3 border-top border-light">
            <div class="input-group bg-light rounded-pill p-1 border">
                <input type="text" id="chat-input" class="form-control border-0 bg-transparent py-2 px-3 shadow-none"
                    placeholder="Hỏi AI về hệ thống..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="btn rounded-circle d-flex align-items-center justify-content-center p-2 me-1"
                    style="width:38px; height:38px; background: var(--primary); border: none;" onclick="sendMessage()">
                    <span class="material-icons-outlined" style="font-size: 18px; color: white;">send</span>
                </button>
            </div>
        </div>
    </div>

    <div id="mention-suggestions"></div>
    <?!= include('js'); ?>
</body>

</html>
